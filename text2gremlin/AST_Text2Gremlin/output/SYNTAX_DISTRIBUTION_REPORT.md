# Gremlin 语法词汇分布统计报告

## 📊 总体统计

| 指标 | 数值 |
|------|------|
| 总查询数 | 1,493 |
| 总步骤数 | 7,353 |
| 不同步骤类型数 | 76 |
| 总谓词数 | 154 |
| 不同谓词类型数 | 3 |
| 平均每个查询的步骤数 | 4.92 |

---

## 🔝 Top 20 最常用步骤

| 排名 | 步骤名称 | 出现次数 | 占比 | 累计占比 |
|------|----------|----------|------|----------|
| 1 | `hasLabel` | 1,485 | 20.20% | 20.20% |
| 2 | `V` | 1,482 | 20.16% | 40.36% |
| 3 | `out` | 1,202 | 16.35% | 56.71% |
| 4 | `in` | 475 | 6.46% | 63.17% |
| 5 | `dedup` | 302 | 4.11% | 67.28% |
| 6 | `by` | 259 | 3.52% | 70.80% |
| 7 | `as` | 254 | 3.45% | 74.25% |
| 8 | `has` | 209 | 2.84% | 77.09% |
| 9 | `groupCount` | 182 | 2.48% | 79.57% |
| 10 | `where` | 147 | 2.00% | 81.57% |
| 11 | `order` | 126 | 1.71% | 83.28% |
| 12 | `limit` | 116 | 1.58% | 84.86% |
| 13 | `union` | 115 | 1.56% | 86.42% |
| 14 | `values` | 109 | 1.48% | 87.90% |
| 15 | `aggregate` | 78 | 1.06% | 88.96% |
| 16 | `repeat` | 76 | 1.03% | 89.99% |
| 17 | `path` | 54 | 0.73% | 90.72% |
| 18 | `coalesce` | 51 | 0.69% | 91.41% |
| 19 | `valueMap` | 47 | 0.64% | 92.05% |
| 20 | `select` | 44 | 0.60% | 92.65% |

**分析**: 前 20 个步骤占总步骤数的 **92.65%**，说明查询模式相对集中。

---

## 📈 步骤分类统计

### 图遍历起始步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `V` | 1,482 | 从顶点开始遍历 |
| `E` | 1 | 从边开始遍历 |

### 过滤步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `hasLabel` | 1,485 | 按标签过滤 |
| `has` | 209 | 按属性过滤 |
| `hasId` | 5 | 按ID过滤 |
| `hasKey` | 6 | 按键过滤 |
| `hasValue` | 2 | 按值过滤 |
| `where` | 147 | 条件过滤 |
| `filter` | 1 | 自定义过滤 |
| `is` | 1 | 值比较过滤 |
| `dedup` | 302 | 去重 |
| `simplePath` | 20 | 简单路径过滤 |
| `cyclicPath` | 1 | 循环路径过滤 |

**小计**: 2,179 次 (29.63%)

### 图遍历步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `out` | 1,202 | 出边遍历 |
| `in` | 475 | 入边遍历 |
| `both` | 2 | 双向遍历 |
| `outE` | 20 | 出边 |
| `inE` | 23 | 入边 |
| `bothE` | 1 | 双向边 |
| `outV` | 1 | 出顶点 |
| `inV` | 1 | 入顶点 |
| `otherV` | 1 | 另一端顶点 |

**小计**: 1,726 次 (23.47%)

### 聚合统计步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `groupCount` | 182 | 分组计数 |
| `count` | 22 | 计数 |
| `sum` | 21 | 求和 |
| `mean` | 6 | 平均值 |
| `max` | 2 | 最大值 |
| `min` | 1 | 最小值 |
| `fold` | 29 | 折叠为列表 |
| `unfold` | 1 | 展开列表 |

**小计**: 264 次 (3.59%)

### 排序和限制步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `order` | 126 | 排序 |
| `limit` | 116 | 限制数量 |
| `range` | 38 | 范围选择 |
| `skip` | 1 | 跳过 |
| `tail` | 1 | 取尾部 |
| `sample` | 30 | 随机采样 |
| `coin` | 1 | 随机过滤 |

**小计**: 313 次 (4.26%)

### 投影和转换步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `values` | 109 | 获取属性值 |
| `valueMap` | 47 | 获取属性映射 |
| `elementMap` | 2 | 获取元素映射 |
| `properties` | 19 | 获取属性对象 |
| `project` | 19 | 投影 |
| `select` | 44 | 选择 |
| `label` | 2 | 获取标签 |
| `id` | 1 | 获取ID |
| `constant` | 1 | 常量值 |
| `identity` | 1 | 恒等变换 |

**小计**: 245 次 (3.33%)

### 分支和条件步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `union` | 115 | 联合多个遍历 |
| `coalesce` | 51 | 合并（返回第一个非空） |
| `choose` | 10 | 条件分支 |
| `optional` | 8 | 可选遍历 |

**小计**: 184 次 (2.50%)

### 循环步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `repeat` | 76 | 重复遍历 |
| `times` | 39 | 重复次数 |
| `until` | 22 | 直到条件满足 |
| `emit` | 32 | 发射中间结果 |

**小计**: 169 次 (2.30%)

### 路径步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `path` | 54 | 获取路径 |
| `tree` | 18 | 树形结构 |

**小计**: 72 次 (0.98%)

### 副作用步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `aggregate` | 78 | 聚合到集合 |
| `store` | 2 | 存储 |
| `sideEffect` | 19 | 副作用 |
| `group` | 7 | 分组 |
| `cap` | 2 | 获取副作用值 |

**小计**: 108 次 (1.47%)

### 修改步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `addV` | 10 | 添加顶点 |
| `property` | 33 | 设置属性 |
| `drop` | 19 | 删除元素 |

**小计**: 62 次 (0.84%)

### 逻辑步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `and` | 5 | 逻辑与 |
| `or` | 2 | 逻辑或 |
| `not` | 3 | 逻辑非 |

**小计**: 10 次 (0.14%)

### 辅助步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `as` | 254 | 标记步骤 |
| `by` | 259 | 修饰符（用于排序、分组等） |
| `map` | 6 | 映射变换 |
| `flatMap` | 15 | 扁平映射 |
| `barrier` | 1 | 屏障 |

**小计**: 535 次 (7.28%)

### 终端步骤
| 步骤 | 次数 | 说明 |
|------|------|------|
| `iterate` | 1 | 迭代执行 |
| `explain` | 1 | 解释查询计划 |
| `profile` | 1 | 性能分析 |

**小计**: 3 次 (0.04%)

---

## 🎯 谓词分布

| 排名 | 谓词 | 出现次数 | 占比 | 说明 |
|------|------|----------|------|------|
| 1 | `neq` | 107 | 69.48% | 不等于 |
| 2 | `within` | 34 | 22.08% | 在集合内 |
| 3 | `gt` | 13 | 8.44% | 大于 |

**总计**: 154 次

**分析**: 
- `neq` (不等于) 是最常用的谓词，主要用于排除自身或特定值
- `within` 用于集合成员判断
- `gt` 用于数值比较

---

## 📝 关键发现

### 1. 查询模式特征
- **几乎所有查询都从 `V()` 开始** (99.26%)，说明主要是顶点遍历查询
- **标签过滤是标配** (`hasLabel` 出现 1,485 次)，说明图数据有明确的类型划分
- **出边遍历远多于入边遍历** (`out`: 1,202 vs `in`: 475)，比例约 2.5:1

### 2. 数据质量控制
- **去重操作频繁** (`dedup` 302 次)，说明查询结果中存在重复数据
- **路径过滤较少** (`simplePath` 20 次)，大多数查询不关心路径唯一性

### 3. 分析需求
- **分组统计需求强** (`groupCount` 182 次)
- **标记和引用常见** (`as` 254 次, `where` 147 次)，说明有复杂的关联查询
- **聚合操作** (`aggregate` 78 次) 用于收集中间结果

### 4. 查询复杂度
- **循环遍历** (`repeat` 76 次) 用于多跳查询
- **分支逻辑** (`union` 115 次, `coalesce` 51 次) 用于多路径探索
- **条件过滤** (`where` 147 次) 用于复杂条件判断

### 5. 覆盖度分析
- **高频步骤** (前 20 个) 占 92.65%，说明核心功能集中
- **长尾步骤** (后 56 个) 仅占 7.35%，但提供了丰富的功能扩展
- **76 种不同步骤类型** 说明 Gremlin 语法覆盖全面

---

## 🎨 使用建议

### 对于测试用例设计
1. **优先覆盖高频步骤**: 重点测试前 20 个步骤的各种组合
2. **关注遍历模式**: `V().hasLabel().out()` 是最常见的模式
3. **测试去重场景**: 确保 `dedup` 在各种位置都能正常工作
4. **验证谓词**: 重点测试 `neq`, `within`, `gt` 三个谓词

### 对于性能优化
1. **优化 `hasLabel` 和 `has`**: 这两个过滤步骤使用最频繁
2. **优化出边遍历**: `out` 步骤占比最高
3. **优化 `groupCount`**: 聚合操作需要特别关注性能

### 对于文档编写
1. **重点讲解高频步骤**: 前 20 个步骤应该有详细文档
2. **提供组合示例**: 展示常见的步骤组合模式
3. **补充长尾功能**: 虽然使用少，但要确保文档完整

---

## 📅 生成信息

- **语料库文件**: `output/generated_corpus_20251029_190729.json`
- **统计时间**: 2025-10-29
- **分析方法**: 基于 ANTLR 解析器的语法树分析
- **统计脚本**: `analyze_syntax_distribution.py`
